<template name="app">
	{{#if Template.subscriptionsReady}}
	{{> Template.dynamic template=currentPage}}
	{{else}}
		<p>OpenLoops is Loading...</p>
	{{/if}}
</template>

<template name="topBanner">
	{{> fullScreenEditor}}
	{{> boardChooserMenu}}
	<div id="top-banner">
		<div class="left">
			{{> openLoopsEye}}
			<span style="margin-left:10px" id="main-title">
				<span class="project-key">{{headerProjectTitle}}</span><br/>
				<a href="" class="project-title">{{headerBoardTitle}}</a>
				<i id="boards-dropdown-button" class="fa fa-caret-down" style="position:relative;top:-5px;left:5px"></i>
			</span>
			<div id="top-header">
				<input id="search-input" class="search-input" placeholder="Type here to search" value={{filterQuery}}>
				<a id="create-link"><i class="fa fa-plus fx-2x"></i></a>
			</div>
		</div>
		<div class="right">
			<div style="position:relative;top:-35px">
				<div id="logged-in-user"><strong>{{currentUser.username}}</strong></div>
				{{#if currentUser}}
					<a href="" id="logout-link" style="display:block;text-align:right;color:white;font-size:12px">logout</a>
				{{/if}}
			</div>
		</div>
		<div class='filter-links' style="display:flex;position: relative;top: -5px;width:900px;display: flex;margin: auto auto;">

			<li id="all-link" class="{{filterLinkActiveClass 'all-link'}} filter-item"><a href="">All</a></li>
			<li id="issues-link" class="{{filterLinkActiveClass 'issues-link'}} filter-item"><a href="">Open Issues</a></li>
			<li id="now-issues-link" class="{{filterLinkActiveClass 'now-issues-link'}} filter-item"><a href="">Now Issues</a></li>
			<li id="assigned-to-me-link" class="{{filterLinkActiveClass 'assigned-to-me-link'}} filter-item"><a href="">Assigned To Me</a></li>
			<li id="bugs-link" class="{{filterLinkActiveClass 'bugs-link'}} filter-item"><a href="">Bugs</a></li>
			<li id="discussions-link" class="{{filterLinkActiveClass 'discussions-link'}} filter-item"><a href="">Discussions</a></li>
			<li id="articles-link" class="{{filterLinkActiveClass 'articles-link'}} filter-item"><a href="">Articles</a></li>
			<li id="closed-link" class="{{filterLinkActiveClass 'closed-link'}} filter-item"><a href="">Closed Items</a></li>
		</div>
	</div>
</template>

<template name="openLoopsEye">
	<a href="/">
		<img src="/images/openloops-o.png" style="position:relative;top:8px;left:10px;width:30px"/>
		<div id="connection-status" class="{{connectionStatus}}" title="Server {{connectionStatus}}"></div>
	</a>
</template>

<template name = "dashboardFeedPage">
	{{#onlyIfLoggedIn}}
		{{> topBanner}}
		{{> leftSidebar}}
		{{> feed}}
		{{> rightSidebar}}
	{{/onlyIfLoggedIn}}
</template>

<template name="feedPage">
	{{#onlyIfProjectAccess}}
		{{> topBanner}}
		{{> leftSidebar}}
		{{> feed}}
		{{> rightSidebar}}
	{{/onlyIfProjectAccess}}
</template>

<template name="createFilterPage">
	{{> leftSidebar}}
	{{> createFilterForm}}
</template>

<template name="createFilterForm">
	<div id="createFilterForm" class="main">
		<form>
			<fieldset>
				<label>Title</label>
				<input name="title" placeholder="Enter title for filter">
				<label>Description</label>
				<input name="query" placeholder="Enter filter query">
			</fieldset>
			<button id="create-button">Create Filter</button>
		</form>
	</div>
</template>

<template name="userCard">
	<div class="user-card" data-username={{username}}>
		<div class="top-section">
		<img src="{{userImageUrl}}"/>
		<div class="content">
			<span class="heading">{{username}}</span>
			<span class="meta">
				<span class="online-status">
					<span class="online-status-dot {{state}}" title="{{state}}"></span>
						<span class="online-status-text">{{state}}</span>
						<span class="online-status-typing">Typing...</span>
					</span>
				</span>
		</div>
		</div>
		<div class='bottom-section'>
			{{#if noWorkingOn}}
			{{#if isCurrentUser}}
				<div class="meta"><a class="working-on-link">What are you working on?</a></div>
			{{else}}
				<div class="meta"><i class='fa fa-circle'></i> Doing nothing</div>
			{{/if}}
			{{else}}
				<div class="meta"><i class='fa fa-circle'></i> <a class="working-on-link">{{workingOn}}</a></div>
			{{/if}}
		</div>
	</div>
</template>

<template name="activityHistory">
	<div><p><i>Not yet implemented - Activity will go here</i></p></div>
</template>

<template name="tabBody">
	<div class="tab-body {{itemTabActiveClass this}}">
		{{> Template.dynamic template=tabBodyTemplate}}
	</div>
</template>

<template name="tabHeader">
	<div class="tab-item {{itemTabActiveClass this}}"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{currentItemId}}/messages"><i class="fa {{icon}}"></i> {{label}}</a></div>
</template>

<template name="feed">
	<div class="main {{#if isTeamFeed}}team-feed{{else}}item-feed{{/if}} {{leftSidebarActiveTab}}">
		<header class="{{currentItemType}} {{currentItemIssueType}}">
			{{#if isTeamFeed}}
				<div class="user-cards">
					{{#each projectUsers}}
						{{> userCard}}
					{{/each}}
				</div>
			{{else}}
			<div id="header-main-title" title="{{currentItemTitle}}"><i class="fa {{currentItemIcon}}" style="color:{{currentItemIconColor}}"></i> {{currentItemTitle}}</div>
			<div id="header-status-bar" style="position: relative;top: 5px;">
				<div id="header-open-status">
					<strong id="open-status-link" class="{{#if currentItemIsOpen}}open{{else}}closed{{/if}}"><i class="fa {{currentItemIcon}}"></i> {{openStatus}}</strong>
				</div>
				<div class="item-tab-bar-wrapper">
					<div class="item-tab-bar">
						{{#each tabs}}
							{{> tabHeader}}
						{{/each}}
					</div>
				</div>
			</div>
			{{/if}}
		</header>
		{{#if isTeamFeed}}
			{{> messageHistory}}
		{{/if}}
		{{#each tabs}}
			{{> tabBody}}
		{{/each}}
		<footer>
			{{> messageBox}}
		</footer>
	</div>
</template>

<template name="itemLabels">
	{{#if currentItemLabelsEmpty}}
		<span class="empty-item-msg">No labels</span>
	{{else}}
		{{#each currentItemLabels}}
			<div class="label-item" style="background-color:{{labelColor this}}">{{labelTitle this}}</div>
		{{/each}}
	{{/if}}
</template>

<template name="messageItemView">
	{{> Template.dynamic template=messageTemplate}}
</template>

<template name="chatMessageItemView">
	<li class="chat-message message" data-id={{_id}}>
		<img class="profile-image" src="{{userImageUrl}}"/>
		<div class="content">
			<span class="header">
				<strong class="header-item">{{createdBy}}</strong>
				<span id="created-at" class="header-item" title={{formatTime createdAt}}>{{timeAgo createdAt}}</span>
				<span id="item-link" class="header-item {{showItemLink}}"><a class="item-link" href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{itemId}}/messages">{{itemTitle}}</a></span>
			</span>
			<div id="text">
				{{#markdown}}{{text}}{{/markdown}}
			</div>
		</div>
	</li>
</template>

<template name="activityMessageItemView">
	<li class="activity-message message" data-id={{_id}}>
		<img class="profile-image" src="{{userImageUrl}}"/>
		<div class="content">
			<span class="header">
				<strong class="header-item">{{createdBy}}</strong>
				<span id="created-at" class="header-item" title={{formatTime createdAt}}>{{timeAgo createdAt}}</span>
				<span id="item-link" class="header-item {{showItemLink}}"><a class="item-link" href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{itemId}}/messages">{{itemTitle}}</a></span>
			</span>
			<div id="text">
				{{{activityMessage}}}
			</div>
			<div id="text" class="{{showActivityContentClass}}" style="border:1px solid whitesmoke;padding:10px;margin-top:10px;background-color:whitesmoke">
				{{#markdown}}{{activityContent}}{{/markdown}}
			</div>
		</div>
	</li>
</template>

<template name="itemItemView">
	<li  data-id={{_id}} >
		<a class="item {{isActive}} {{isClosedClass}}" href="">
		<i id="type-icon" class="fa {{typeIcon}}" style="color:{{typeIconColor}}"></i>
		<div id="content">
			<span id="title">{{title}} </span>
			<div id="meta">

				<span class="item-key">#{{projectKey this}}-{{pid}}</span> ●
				{{timeAgo createdAt}}
				{{#if itemHasAssignee this}}
					● <span><img src={{assigneeImageUrl this}} class="assignee-item" title="Assigned to {{assigneeUsername this}}"/></span>
				{{/if}}
			</div>
			<div id="meta"> {{description}}</div>
			<div id="item-labels">
				{{#each itemLabels}}
					<span class="label-item" style="background-color:{{labelColor this}}">{{labelTitle this}}</span>
				{{/each}}
			</div>
		</div>
		<div class="item-msg-count" data-msg-count="0">
		</div>
		</a>
	</li>
</template>

<template name="filterItem">
	<li><a href="">{{title}}</a></li>
</template>

<template name="boardChooserMenu">
	<ul id="board-chooser-menu" style="display:none">
		<div class="menu-item-header">Select Board</div>
		{{#each boards}}
			{{> boardChooserItem}}
		{{/each}}
	</ul>
</template>

<template name="boardChooserItem">
	<li class="menu-item">{{title}}</li>
</template>

<template name="moveToBoardList">
	<ul id="move-to-board-list" style="display:none">
		<div class="menu-item-header">Move to</div>
		{{#each boards}}
			{{> moveToBoardItem}}
		{{/each}}
	</ul>
</template>

<template name="moveToBoardItem">
	<li class="menu-item">{{title}}</li>
</template>

<template name="notAllowed">
	<div class="alert message"><i class="fa fa-exclamation-triangle"></i> Ooops, sorry - only admins are allowed here</div>
</template>


<template name="welcomePage">
	<div class="alert message">
	<h1>Welcome</h1>
	{{#if currentUser}}
		This screen is a work in progress - eventually it will say great things about OLS.
		<p>Click <a href="/projects">here</a> for your projects</p>
		<p>Click <a href="/team-members">here</a> to configure your team</p>
	{{else}}
		<p>Please <a href="/login">login</a> or <a href="/signup">sign-up</a> to continue</p>
	{{/if}}
	</div>
</template>

<template name="notFoundPage">
	<div class="alert message">
		<i class="fa fa-exclamation-triangle"></i> 404: Oops, this page doesn't exist, sorry.  Click <a href="/">here</a> to find your way home.
	</div>
</template>

<template name="onlyIfProjectAccess">
  {{#if authInProcess}}
    <p>Loading ...</p>
  {{else}}
    {{#if canShow}}
      {{> UI.contentBlock }}
    {{else}}
      <p>You are not authorized to access this project.</p>
      <p>Click <a href="/">here</a> to return home</p>
    {{/if}}
  {{/if}}
</template>

<template name="onlyIfLoggedIn">
  {{#if authInProcess}}
    <p>Loading ...</p>
  {{else}}
    {{#if canShow}}
      {{> UI.contentBlock }}
    {{else}}
      <p>You are not authorized to view this page.</p>
      <p>Please <a href="/login">login</a> to view this page</p>
    {{/if}}
  {{/if}}
</template>

<template name="onlyIfAdminUser">
  {{#if authInProcess}}
    <p>Loading ...</p>
  {{else}}
    {{#if canShow}}
      {{> UI.contentBlock }}
	  {{else}}
	  <div class="alert message"><i class="fa fa-exclamation-triangle"></i>
		  Ooops, sorry - only admins are allowed here
		  <p>Click <a href="/">here</a> to return.</p>
	  </div>
	  {{/if}}
  {{/if}}
</template>
