<template name="app">
	<div id="top-banner">
		<div class="left">
			<a href="/"><img src="/images/openloops-o.png" style="position:relative;top:8px;left:10px;width:30px"/></a>
			<span style="margin-left:10px" id="main-title"><a href="/board/{{currentBoardId}}" style="text-decoration:none">{{currentBoardTitle}}</a></span>
		</div>
		<div class="right">
			<div id="connection-status" class="{{connectionStatus.status}}" title="Server {{connectionStatus.status}}"></div>
			<div style="position:relative;top:-10px">
				<div id="logged-in-user"><strong>{{currentUser.username}}</strong></div>
				{{#if currentUser}}
					<a href="" id="logout-link" style="display:block;text-align:right;color:white;font-size:12px">logout</a>
				{{/if}}
			</div>
		</div>
	</div>
	{{> Template.dynamic template=currentPage}}
</template>

<template name="feedPage">
	{{> leftSidebar}}
	{{> feed}}
	{{> rightSidebar}}
</template>

<template name="createFilterPage">
	{{> leftSidebar}}
	{{> createFilterForm}}
</template>

<template name="createFilterForm">
	<div id="createFilterForm" class="main">
		<form>
			<fieldset>
				<label>Title</label>
				<input name="title" placeholder="Enter title for filter">
				<label>Description</label>
				<input name="query" placeholder="Enter filter query">
			</fieldset>
			<button id="create-button">Create Filter</button>
		</form>
	</div>
</template>

<template name="editItemPage">
	{{> editItemForm}}
</template>

<template name="editItemForm">
	<div id="editItemForm" class="main">
		<form>
			<fieldset>
				<label>Title</label>
				<input name="title" placeholder="Enter title" value={{title}}>
				<label>Description</label>
				<textarea name="description" placeholder="Enter description" rows="20" value={{description}}></textarea>
				<label>Labels</label>
				<input name="labels" placeholder="Add labels here" value="{{labels}}">
				<label style="display:inline">Type</label>
				<select name="type" placeholder="Enter type">
					<option {{isSelectedType 'issue'}} value="issue">Issue</option>
					<option {{isSelectedType 'discussion'}} value="discussion">Discussion</option>
					<option {{isSelectedType 'article'}} value="article">Article</option>
				</select>
				<span class="{{showIssueType}}" style="margin-left:50px">
					<label style="margin-top:30px;display:inline">Issue Type</label>
					<select name="issueType">
						<option {{isSelectedIssueType 'task'}} value="task">Task</option>
						<option {{isSelectedIssueType 'bug'}} value="bug">Bug</option>
						<option {{isSelectedIssueType 'enhancement'}} value="enhancement">Enhancement</option>
					</select>
				</span>
			</fieldset>
			<button id="save-button">Save</button>
		</form>
	</div>
</template>

<template name="leftSidebar">
	<div class="left-sidebar">
		<div id="top-header">
			<input id="search-input" class="search-input" placeholder="Type here to filter" value={{filterQuery}}>
			<a id="create-link" href="/board/{{currentBoardId}}/create-item"><i class="fa fa-plus fx-2x"></i></a>
		</div>
		<ul class="item-list">
			{{#each items}}
				{{> itemItemView}}
			{{/each}}
		</ul>
	</div>
</template>

<template name="rightSidebar">
	<div class="right-sidebar">
		{{#if isTeamFeed}}
		<span class="header-text">ACTIONS</span>
		<ul class="action-buttons">
			<li id="create-discussion-link" class="action-button"><a href="/board/{{currentBoardId}}/create-item"><i class="fa fa-comments-o"></i> New Discussion</a></li>
			<li id="create-issue-link" class="action-button"><a href="/board/{{currentBoardId}}/create-item"><i class="fa fa-exclamation-circle"></i> New Issue</a></li>
			<li id="create-article-link" class="action-button"><a href="/board/{{currentBoardId}}/create-item"><i class="fa fa-book"></i> New Article</a></li>
		</ul>
		{{else}}
		<span class="header-text">ACTIONS</span>
		<ul class="action-buttons">
			<li id="open-close-link" class="action-button"><i class="fa fa-times"></i> {{#if currentItemIsOpen}}Close{{else}}Open{{/if}}</li>
			<li id="move-link" class="action-button"><i class="fa fa-arrow-right"></i> Move</li>
		</ul>
		<span class="header-text">LABELS</span>
		<ul class="label-buttons">
			No Labels
		</ul>
		{{#if isIssue}}
			<span class="header-text">ASSIGNEE</span>
			<ul class="assignee-buttons">
				Noone is assigned
			</ul>
			<span class="header-text">ESTIMATES</span>
			<ul class="estimate-buttons">
				No Estimates
			</ul>
		{{/if}}

		{{/if}}
	</div>
</template>

<template name="feed">
	<div class="main {{#if isTeamFeed}}team-feed{{else}}item-feed{{/if}} {{leftSidebarActiveTab}}">
		{{> moveToBoardList}}
		<header class="{{currentItemType}} {{currentItemIssueType}}">
			{{#if isTeamFeed}}
				<div class="user-cards" style="margin:0;padding:0;margin-left:10px">
					<div class="user-card" style="width:150px;padding:5px;background-color:black">
						<img src="http://semantic-ui.com/images/avatar2/large/kristy.png" style="float-left;width:30px;"/>
						<span style="color:white;text-transform:uppercase">Paul</span>
						<div class="content" style="padding-left:10px">
							<p class="meta">Working on #OLS-42</p>
						</div>
					</div>
				</div>
				<!--<ul id="header-feed-links">
					<li class="{{isActive ''}}"><a href="/"><i class="fa fa-home"></i> Feed</a></li>
					<li class="{{isActive 'discussion'}}"><a href="/feed/search?query=type:discussion"><i class="fa fa-comments-o"></i> Discussions</a></li>
					<li class="{{isActive 'issue'}}"><a href="/feed/search?query=type:issue"><i class="fa fa-exclamation-circle"></i> Issues</a></li>
					<li class="{{isActive 'article'}}"><a href="/feed/search?query=type:article"><i class="fa fa-book"></i> Articles</a></li>
					<li><input id="search-input" placeholder="Type here to search" value={{filterQuery}}></li>
				</ul>-->
			{{else}}
			<div id="header-main-title"><i class="fa {{currentItemIcon}}" style="color:{{currentItemIconColor}}"></i> {{currentItemTitle}}</div>
			<div id="header-labels">
				{{> itemLabels}}
			</div>
			<div id="header-status-bar">
				<div id="header-open-status">
					<strong id="open-status-link" class="{{#if currentItemIsOpen}}open{{else}}closed{{/if}}"><i class="fa {{currentItemIcon}}"></i> {{openStatus}}</strong>
				</div>
			</div>

			{{#if hasIncomingMessages}}
				<a href="" id="header-new-messages-toast"><i class="fa fa-comments-o"></i> {{numIncomingMessages}} New Messages - click to show</a>
			{{/if}}
			{{/if}}

		</header>
		<ul id="message-list">
			<a href="" id="loading-more" style="visibility:{{#if moreMessagesOnServer}}visible{{else}}hidden{{/if}}"><i id="loading-more-icon" class="fa fa-spinner fa-pulse"></i></a>
			{{#each messages}}
			{{> messageItemView}}
			{{/each}}
		</ul>
		<footer>
			{{> messageBox}}
		</footer>
	</div>
</template>

<template name="itemLabels">
	{{#each currentItemLabels}}
		<span class="label-item">{{this}}</span>
	{{/each}}
</template>

<template name="messageBox">
	<textarea id="message-box" placeholder="Type here to comment"></textarea>
</template>

<template name="messageItemView">
	{{> Template.dynamic template=messageTemplate}}
</template>

<template name="userMessageItemView">
	<li class="user-message message" data-id={{_id}}>
		<span class="meta">
			<strong>{{createdBy}}</strong>
			<span id="created-at">{{timeAgo createdAt}}</span>
			<span id="item-link" class="{{showItemLink}}"><a class="item-link" href="/board/{{currentBoardId}}/item/{{itemId}}">{{itemTitle}}</a></span>
		</span>
		<div id="text">
			{{#markdown}}{{text}}{{/markdown}}
		</div>
		<div class="meta">

		</div>
	</li>
</template>

<template name="itemMessageItemView">
	<li class="item-message message" data-id={{_id}}>
		<div class="title">
			<i id="type-icon" class="fa {{itemTypeIcon}}" style="color:{{typeIconColor}}"></i>
			<strong><a href="/board/{{currentBoardId}}/item/{{itemId}}">{{itemTitle}}</a></strong>
		</div>
		<span class="meta">
			<span id="created-by">created by {{createdBy}}</span>
			<span id="created-at">{{timeAgo createdAt}}</span> <a id="edit-link" href="/board/{{currentBoardId}}/edit-item">Edit</a>
			<span id="item-link" class="{{showItemLink}}"> in <a class="item-link" href="/board/{{currentBoardId}}/item/{{itemId}}">{{itemTitle}}</a></span>
		</span>
		<div id="item-desc">{{#markdown}}{{text}}{{/markdown}}</div>
	</li>
</template>

<template name="itemItemView">
	<li  data-id={{_id}}>
		<a class="item {{isActive}}" href="/board/{{currentBoardId}}/item/{{_id}}">
		<i id="type-icon" class="fa {{typeIcon}}" style="color:{{typeIconColor}}"></i>
		<div id="content">
			<span id="title">{{title}}</span>
			<div id="meta"> <strong>{{createdBy}}</strong> {{timeAgo createdAt}} </div>
			<div id="meta"> {{description}}</div>
			<div id="item-labels">
				{{#each itemLabels}}
					<span class="label-item">{{this}}</span>
				{{/each}}
			</div>
		</div>
		<div class="item-msg-count">
			<i class="fa fa-comment-o"></i> {{numMessages}}
		</div>
		</a>
	</li>
</template>

<template name="filterItem">
	<li><a href="">{{title}}</a></li>
</template>

<template name="moveToBoardList">
	<ul id="move-to-board-list" style="display:none">
		<div class="menu-item-header">Move to</div>
		{{#each boards}}
			{{> moveToBoardItem}}
		{{/each}}
	</ul>
</template>

<template name="moveToBoardItem">
	<li class="menu-item">{{title}}</li>
</template>
