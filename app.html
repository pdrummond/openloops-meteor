<template name="app">
	{{#if Template.subscriptionsReady}}
	{{> Template.dynamic template=currentPage}}
	{{else}}
		<p>OpenLoops is Loading...</p>
	{{/if}}
</template>

<template name="topBanner">
	{{> boardChooserMenu}}
	<div id="top-banner">
		<div class="left">
			{{> openLoopsEye}}
			<span style="margin-left:10px" id="main-title">
				<a href="" class="project-title"><span class="project-key">{{currentProjectKey}}</span>: {{currentProjectTitle}} </a>
				<a href="" class="board-title">{{currentBoardTitle}}</a>
			</span>
			<div id="top-header">
				<input id="search-input" class="search-input" placeholder="Type here to search" value={{filterQuery}}>
				<a id="create-link" href="/project/{{currentProjectId}}/board/{{currentBoardId}}/create-item"><i class="fa fa-plus fx-2x"></i></a>
			</div>
		</div>
		<div class="right">
			<div style="position:relative;top:-35px">
				<div id="logged-in-user"><strong>{{currentUser.username}}</strong></div>
				{{#if currentUser}}
					<a href="" id="logout-link" style="display:block;text-align:right;color:white;font-size:12px">logout</a>
				{{/if}}
			</div>
		</div>
		<div class='filter-links' style="display:flex;position: relative;top: -10px;display: flex;width: 700px;margin: auto auto;">
			<li id="all-link" class="{{filterLinkActiveClass 'all-link'}} filter-item"><a href="">All</a></li>
			<li id="issues-link" class="{{filterLinkActiveClass 'issues-link'}} filter-item"><a href="">Issues</a></li>
			<li id="bugs-link" class="{{filterLinkActiveClass 'bugs-link'}} filter-item"><a href="">Bugs</a></li>
			<li id="discussions-link" class="{{filterLinkActiveClass 'discussions-link'}} filter-item"><a href="">Discussions</a></li>
			<li id="articles-link" class="{{filterLinkActiveClass 'articles-link'}} filter-item"><a href="">Articles</a></li>
			<li id="now-issues-link" class="{{filterLinkActiveClass 'now-issues-link'}} filter-item"><a href="">Now Issues</a></li>
			<li id="closed-link" class="{{filterLinkActiveClass 'closed-link'}} filter-item"><a href="">Closed Items</a></li>
		</div>
	</div>
</template>

<template name="openLoopsEye">
	<a href="/">
		<img src="/images/openloops-o.png" style="position:relative;top:8px;left:10px;width:30px"/>
		<div id="connection-status" class="{{connectionStatus}}" title="Server {{connectionStatus}}"></div>
	</a>
</template>

<template name="feedPage">
	{{#onlyIfLoggedIn}}
		{{> topBanner}}
		{{> leftSidebar}}
		{{> feed}}
		{{> rightSidebar}}
	{{/onlyIfLoggedIn}}
</template>

<template name="createFilterPage">
	{{> leftSidebar}}
	{{> createFilterForm}}
</template>

<template name="createFilterForm">
	<div id="createFilterForm" class="main">
		<form>
			<fieldset>
				<label>Title</label>
				<input name="title" placeholder="Enter title for filter">
				<label>Description</label>
				<input name="query" placeholder="Enter filter query">
			</fieldset>
			<button id="create-button">Create Filter</button>
		</form>
	</div>
</template>

<template name="editItemPage">
	{{#onlyIfLoggedIn}}
		{{> editItemForm}}
	{{/onlyIfLoggedIn}}
</template>

<template name="editItemForm">
	<div id="top-banner">
		<div class="left">
			{{> openLoopsEye}}
			<span class="form-title">
				{{formTitle}}
			</span>
		</div>
		<div class="right">
			<div style="position:relative;top:-20px">
				<div id="logged-in-user"><strong>{{currentUser.username}}</strong></div>
				{{#if currentUser}}
					<a href="" id="logout-link" style="display:block;text-align:right;color:white;font-size:12px">logout</a>
				{{/if}}
			</div>
		</div>
	</div>
	{{#onlyIfLoggedIn}}
	{{#if isBusy}}
		{{> spinner}}
	{{else}}
	<div id="editItemForm" class="form">
		<form>
			<fieldset>
				<label style="display:inline;margin-right:10px">Type</label>
				<select name="type" placeholder="Enter type">
					<option {{isSelectedType 'issue'}} value="issue">Issue</option>
					<option {{isSelectedType 'discussion'}} value="discussion">Discussion</option>
					<option {{isSelectedType 'article'}} value="article">Article</option>
				</select>
				<span class="{{showIssueType}}" style="margin-left:50px;">
					<label style="margin-top:30px;display:inline;margin-right:10px">Issue Type</label>
					<select name="issueType">
						<option {{isSelectedIssueType 'task'}} value="task">Task</option>
						<option {{isSelectedIssueType 'bug'}} value="bug">Bug</option>
						<option {{isSelectedIssueType 'enhancement'}} value="enhancement">Enhancement</option>
					</select>
				</span>

				<label style="margin-top:30px">Title</label>
				<input name="title" placeholder="Enter title" value={{title}} autofocus>
				<label>Description</label>
				<textarea name="description" placeholder="Enter description" value={{description}}></textarea>
				<label>Labels</label>
				<input name="labels" placeholder="Add labels here, e.g: #important, #milestone1, #in-progress" value="{{labels}}">

			</fieldset>
			<button id="save-button" class='button-default'>Save</button>
			<button id="cancel-button"> Cancel</button>
		</form>
	</div>
	{{/if}}
	{{/onlyIfLoggedIn}}
</template>

<template name="leftSidebar">
	<div class="left-sidebar">
		<div id="board-item">
			<a class="item {{isBoardItemActive}}" href="/project/{{currentProjectId}}/board/{{currentBoardId}}">
				<i id="type-icon" class="fa fa-home" style="color:black"></i>
				<div id="content">
					<span id="title">Home</span>
				</div>
				<div class="item-msg-count" data-msg-count="0">
				</div>
			</a>
		</div>
		<ul class="item-list">
			{{#each items}}
				{{> itemItemView}}
			{{/each}}
		</ul>
	</div>
</template>

<template name="rightSidebar">
	<div class="right-sidebar">
		{{#if isTeamFeed}}
		<span class="header-text">ACTIONS</span>
		<ul class="action-buttons">
			<li id="create-discussion-link" class="action-button"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/create-item?type=discussion"><i class="fa fa-comments-o"></i> New Discussion</a></li>
			<li id="create-issue-link" class="action-button"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/create-item?type=issue"><i class="fa fa-exclamation-circle"></i> New Issue</a></li>
			<li id="create-article-link" class="action-button"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/create-item?type=article"><i class="fa fa-book"></i> New Article</a></li>
		</ul>
		{{else}}
		<span class="header-text">ACTIONS</span>
		<ul class="action-buttons">
			<li id="edit-link" class="action-button"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/edit-item/{{currentItemId}}"><i class="fa fa-pencil"></i> Edit</a></li>
			<li id="open-close-link" class="action-button"><a href=""><i class="fa fa-times"></i> {{#if currentItemIsOpen}}Close{{else}}Open{{/if}}</a></li>
			<li id="move-link" class="action-button"><a href=""><i class="fa fa-arrow-right"></i> Move</a></li>
		</ul>
		{{> moveToBoardList}}
		<span class="header-text">LABELS</span>
		<ul class="label-buttons">
			{{> itemLabels}}
		</ul>
		{{#if isIssue}}
			<span class="header-text">ASSIGNEE</span>
			<ul class="assignee-buttons">
				Noone is assigned
			</ul>
			<span class="header-text">ESTIMATES</span>
			<ul class="estimate-buttons">
				No Estimates
			</ul>
		{{/if}}

		{{/if}}
	</div>
</template>

<template name="feed">
	<div class="main {{#if isTeamFeed}}team-feed{{else}}item-feed{{/if}} {{leftSidebarActiveTab}}">
		<header class="{{currentItemType}} {{currentItemIssueType}}">
			{{#if isTeamFeed}}
				<div class="user-cards" style="display:none;background:whitesmoke">
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar/small/daniel.jpg"/>
						<div class="content">
							<span class="heading">Paul Drummond</span>
							<span class="meta"><span class="online-status"><span class="online-status-dot typing" title="Typing"></span> Typing...</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta"><i class='fa fa-code'></i> Implementing #OLS-42</div>
						</div>
					</div>
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar/small/elliot.jpg"/>
						<div class="content">
							<span class="heading">Harold Tester</span>
							<span class="meta"><span class="online-status offline"><span class="online-status-dot"></span> Offline (on holiday)</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta" title=""><i class='fa fa-coffee'></i> Lying on a beach somewhere <i class="fa fa-smile-o"></i></div>
						</div>
					</div>
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar/small/stevie.jpg"/>
						<div class="content">
							<span class="heading">Bobby Tester</span>
							<span class="meta"><span class="online-status"><span class="online-status-dot typing" title="Typing"></span> Typing...</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta" title="Testing #OLS-20"><i class='fa fa-bug'></i> Fixing #OLS-20</div>
						</div>
					</div>
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar/small/christian.jpg"/>
						<div class="content">
							<span class="heading">George Tester</span>
							<span class="meta"><span class="online-status away"><span class="online-status-dot"></span> Away</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta" title="Testing #OLS-20"><i class='fa fa-code-fork'></i> Creating test branch for #OLS-323 </div>
						</div>
					</div>
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar/small/helen.jpg"/>
						<div class="content">
							<span class="heading">Lynda Tester</span>
							<span class="meta"><span class="online-status busy"><span class="online-status-dot"></span> Busy</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta" title="Testing #OLS-20"><i class='fa fa-code'></i> Implememting #OLSX-666</div>
						</div>
					</div>
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar2/small/mark.png"/>
						<div class="content">
							<span class="heading">John Tester</span>
							<span class="meta"><span class="online-status"><span class="online-status-dot online" title="Online"></span> Online</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta" title="Testing #OLS-20"><i class='fa fa-bug'></i> Fixing bug #OLS-20</div>
						</div>
					</div>
					<div class="user-card">
						<div class="top-section">
						<img src="http://semantic-ui.com/images/avatar2/small/lindsay.png"/>
						<div class="content">
							<span class="heading">Joyce Tester</span>
							<span class="meta"><span class="online-status"><span class="online-status-dot online" title="Online"></span> Online</span></span>
						</div>
						</div>
						<div class='bottom-section'>
						<div class="meta" title="Testing #OLS-20"><i class='fa fa-cog'></i> Testing #OLS-200</div>
						</div>
					</div>
				</div>
				<!--<ul id="header-feed-links">
					<li class="{{isActive ''}}"><a href="/"><i class="fa fa-home"></i> Feed</a></li>
					<li class="{{isActive 'discussion'}}"><a href="/feed/search?query=type:discussion"><i class="fa fa-comments-o"></i> Discussions</a></li>
					<li class="{{isActive 'issue'}}"><a href="/feed/search?query=type:issue"><i class="fa fa-exclamation-circle"></i> Issues</a></li>
					<li class="{{isActive 'article'}}"><a href="/feed/search?query=type:article"><i class="fa fa-book"></i> Articles</a></li>
					<li><input id="search-input" placeholder="Type here to search" value={{filterQuery}}></li>
				</ul>-->
			{{else}}
			<div id="header-main-title" title="{{currentItemTitle}}"><i class="fa {{currentItemIcon}}" style="color:{{currentItemIconColor}}"></i> {{currentItemTitle}}</div>
			<div id="header-status-bar">
				<div id="header-open-status">
					<strong id="open-status-link" class="{{#if currentItemIsOpen}}open{{else}}closed{{/if}}"><i class="fa {{currentItemIcon}}"></i> {{openStatus}}</strong>
				</div>
				<div class="item-tab-bar-wrapper">
					<div class="item-tab-bar">
						<div class="tab-item {{isTabActive 'description'}}"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{currentItemId}}/description"><i class="fa fa-info-circle"></i> Description</a></div>
						<div class="tab-item {{isTabActive 'messages'}}"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{currentItemId}}/messages"><i class="fa fa-comments-o"></i> Messages</a></div>
						<div class="tab-item {{isTabActive 'todos'}}"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{currentItemId}}/todos"><i class="fa fa-list"></i> Todo Items</a></div>
						<div class="tab-item {{isTabActive 'activity'}}"><a href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{currentItemId}}/activity"><i class="fa fa-exchange"></i> Activity</a></div>
					</div>
				</div>
			</div>
			{{/if}}
		</header>
		<div class="tab-body {{isTabActive 'messages'}}">
			{{> messageHistory}}
		</div>
		<div class="tab-body {{isTabActive 'description'}}">
			<div class="current-item-description">{{#markdown}}{{currentItemDescription}}{{/markdown}}</div>
		</div>
		<div class="tab-body {{isTabActive 'todos'}}">
			<div class="current-item-todos"><p><i>Not yet implemented - TODOS will go here</i></p></div>
		</div>
		<div class="tab-body {{isTabActive 'activity'}}">
			<div class="current-item-activity"><p><i>Not yet implemented - all item-specific activity will be listed here</i></p></div>
		</div>
		<footer>
			{{> messageBox}}
		</footer>
	</div>
</template>

<template name="itemLabels">
	{{#if currentItemLabelsEmpty}}
		<span class="empty-item-msg">No labels</span>
	{{else}}
		{{#each currentItemLabels}}
			<div class="label-item">{{this}}</div>
		{{/each}}
	{{/if}}
</template>

<template name="messageItemView">
	{{> Template.dynamic template=messageTemplate}}
</template>

<template name="chatMessageItemView">
	<li class="chat-message message" data-id={{_id}}>
		<img class="profile-image" src="{{userImageUrl}}"/>
		<div class="content">
			<span class="header">
				<strong>{{createdBy}}</strong>
				<span id="created-at">{{timeAgo createdAt}}</span>
				<span id="item-link" class="{{showItemLink}}"><a class="item-link" href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{itemId}}">{{itemTitle}}</a></span>
			</span>
			<div id="text">
				{{#markdown}}{{text}}{{/markdown}}
			</div>
		</div>
	</li>
</template>

<template name="activityMessageItemView">
	<li class="activity-message message" data-id={{_id}}>
		<img class="profile-image" src="{{userImageUrl}}"/>
		<div class="content">
			<span class="header">
				<strong>{{createdBy}}</strong>
				<span id="created-at">{{timeAgo createdAt}}</span>
				<span id="item-link" class="{{showItemLink}}"><a class="item-link" href="/project/{{currentProjectId}}/board/{{currentBoardId}}/item/{{itemId}}">{{itemTitle}}</a></span>
			</span>
			<div id="text">
				{{{activityMessage}}}
			</div>
			<div id="text" class="{{showActivityContentClass}}" style="border:1px solid whitesmoke;padding:10px;margin-top:10px;background-color:whitesmoke">
				{{#markdown}}{{activityContent}}{{/markdown}}
			</div>
		</div>
	</li>
</template>


<template name="itemItemView">
	<li  data-id={{_id}} >
		<a class="item {{isActive}} {{isClosedClass}}" href="">
		<i id="type-icon" class="fa {{typeIcon}}" style="color:{{typeIconColor}}"></i>
		<div id="content">
			<span id="title">{{title}}</span>
			<div id="meta"> <span class="item-key">#{{projectKey this}}-{{pid}}</span> ● <span class="creared-by">{{createdBy}}</span> ● {{timeAgo createdAt}} </div>
			<div id="meta"> {{description}}</div>
			<div id="item-labels">
				{{#each itemLabels}}
					<span class="label-item">{{this}}</span>
				{{/each}}
			</div>
		</div>
		<div class="item-msg-count" data-msg-count="0">
		</div>
		</a>
	</li>
</template>

<template name="filterItem">
	<li><a href="">{{title}}</a></li>
</template>

<template name="boardChooserMenu">
	<ul id="board-chooser-menu" style="display:none">
		<div class="menu-item-header">Select Board</div>
		<li id="all-boards-item" class="menu-item" style="border-bottom: 1px solid gray;background-color:#ddd">All Boards</li>
		{{#each boards}}
			{{> boardChooserItem}}
		{{/each}}
	</ul>
</template>

<template name="boardChooserItem">
	<li class="menu-item">{{title}}</li>
</template>

<template name="moveToBoardList">
	<ul id="move-to-board-list" style="display:none">
		<div class="menu-item-header">Move to</div>
		{{#each boards}}
			{{> moveToBoardItem}}
		{{/each}}
	</ul>
</template>

<template name="moveToBoardItem">
	<li class="menu-item">{{title}}</li>
</template>

<template name="notAllowed">
	<div class="alert message"><i class="fa fa-exclamation-triangle"></i> Ooops, sorry - only admins are allowed here</div>
</template>


<template name="welcomePage">
	<div class="alert message">
	<h1>Welcome</h1>
	{{#if currentUser}}
		This screen is a work in progress - eventually it will say great things about OLS.
		<p>Click <a href="/projects">here</a> for your projects</p>
		<p>Click <a href="/team-members">here</a> to configure your team</p>
	{{else}}
		<p>Please <a href="/login">login</a> or <a href="/signup">sign-up</a> to continue</p>
	{{/if}}
	</div>
</template>

<template name="notFoundPage">
	<div class="alert message">
		<i class="fa fa-exclamation-triangle"></i> 404: Oops, this page doesn't exist, sorry.  Click <a href="/">here</a> to find your way home.
	</div>
</template>

<template name="onlyIfLoggedIn">
  {{#if authInProcess}}
    <p>Loading ...</p>
  {{else}}
    {{#if canShow}}
      {{> UI.contentBlock }}
    {{else}}
      <p>You are not authorized to view this page.</p>
      <p>Please <a href="/login">login</a> to view this page</p>
    {{/if}}
  {{/if}}
</template>

<template name="onlyIfAdminUser">
  {{#if authInProcess}}
    <p>Loading ...</p>
  {{else}}
    {{#if canShow}}
      {{> UI.contentBlock }}
	  {{else}}
	  <div class="alert message"><i class="fa fa-exclamation-triangle"></i>
		  Ooops, sorry - only admins are allowed here
		  <p>Click <a href="/">here</a> to return.</p>
	  </div>
	  {{/if}}
  {{/if}}
</template>
